generator client {
    provider      = "prisma-client"
    output        = "../src/generated/prisma"
    binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
}

model Bucket {
    id    Int    @id @default(autoincrement())
    name  String
    slug  String @unique
    order Int

    objectives Objective[]
}

model Objective {
    id        Int       @id @default(autoincrement())
    bucketId  Int
    name      String
    slug      String    @unique
    startDate DateTime?
    dueDate   DateTime?
    status    Status    @default(notstarted)

    bucket       Bucket        @relation(fields: [bucketId], references: [id])
    blocks       Block[]
    sessions     Session[]
    timePerWeeks TimePerWeek[]
}

model Block {
    id            Int    @id @default(autoincrement())
    name          String
    year          Int
    weekNumber    Int
    objectiveId   Int
    status        Status @default(notstarted)
    scheduledTime Int    @default(0)

    objective Objective @relation(fields: [objectiveId], references: [id])
    week      Week      @relation(fields: [year, weekNumber], references: [year, weekNumber])

    @@index([year, weekNumber, objectiveId])
}

model Week {
    id         Int @id @default(autoincrement())
    year       Int
    weekNumber Int

    blocks       Block[]
    timePerWeeks TimePerWeek[]

    @@unique([year, weekNumber])
}

model TimePerWeek {
    id            Int      @id @default(autoincrement())
    year          Int
    weekNumber    Int
    itemType      ItemType @default(objective)
    objectiveId   Int?
    scheduledTime Int      @default(0)

    objective Objective? @relation(fields: [objectiveId], references: [id])
    week      Week       @relation(fields: [year, weekNumber], references: [year, weekNumber])

    @@unique([year, weekNumber, itemType, objectiveId])
}

model Session {
    id          Int       @id @default(autoincrement())
    itemType    ItemType  @default(objective)
    objectiveId Int?
    startTime   DateTime
    endTime     DateTime?
    notes       String?

    objective Objective? @relation(fields: [objectiveId], references: [id])
}

model KeyValue {
    key   String @id
    value String
}

model GoogleCalendarId {
    id   String  @id
    name String?
}

model BusinessHours {
    id         Int    @id @default(autoincrement())
    daysOfWeek Int[]
    startTime  String
    endTime    String
}

enum Status {
    notstarted
    archived
    inprogress
    onhold
    completed
}

enum ItemType {
    bucket
    objective
    block
}
