generator client {
    provider   = "prisma-client"
    output     = "../src/generated/prisma"
    engineType = "client"
}

datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
}

model Bucket {
    id    Int    @id @default(autoincrement())
    name  String
    slug  String @unique
    order Int

    objectives Objective[]
}

model Objective {
    id        Int       @id @default(autoincrement())
    bucketId  Int
    name      String
    slug      String    @unique
    startDate DateTime?
    dueDate   DateTime?
    status    Status    @default(notstarted)

    bucket       Bucket        @relation(fields: [bucketId], references: [id])
    tasks        Task[]
    sessions     Session[]
    timePerWeeks TimePerWeek[]
}

model Task {
    id            Int       @id @default(autoincrement())
    name          String
    objectiveId   Int
    status        Status    @default(notstarted)
    estimatedTime Int       @default(0)
    deadline      DateTime?

    objective    Objective     @relation(fields: [objectiveId], references: [id])
    timePerWeeks TimePerWeek[]
    sessions     Session[]
}

model Week {
    id         Int @id @default(autoincrement())
    year       Int
    weekNumber Int

    timePerWeeks TimePerWeek[]

    @@unique([year, weekNumber])
}

model TimePerWeek {
    id            Int      @id @default(autoincrement())
    year          Int
    weekNumber    Int
    itemType      ItemType @default(objective)
    objectiveId   Int?
    taskId        Int?
    scheduledTime Int      @default(0)
    completed     Boolean  @default(false)

    objective Objective? @relation(fields: [objectiveId], references: [id])
    task      Task?      @relation(fields: [taskId], references: [id])
    week      Week       @relation(fields: [year, weekNumber], references: [year, weekNumber])

    @@unique([year, weekNumber, itemType, objectiveId, taskId])
}

model Session {
    id          Int       @id @default(autoincrement())
    itemType    ItemType  @default(objective)
    objectiveId Int?
    taskId      Int?
    startTime   DateTime
    endTime     DateTime?
    notes       String?
    notesJson   Json?

    objective Objective? @relation(fields: [objectiveId], references: [id])
    task      Task?      @relation(fields: [taskId], references: [id])
}

model KeyValue {
    key   String @id
    value String
}

model GoogleCalendarId {
    id   String  @id
    name String?
}

model BusinessHours {
    id         Int    @id @default(autoincrement())
    daysOfWeek Int[]
    startTime  String
    endTime    String
}

enum Status {
    notstarted
    archived
    inprogress
    onhold
    completed
}

enum ItemType {
    bucket
    objective
    task
}
